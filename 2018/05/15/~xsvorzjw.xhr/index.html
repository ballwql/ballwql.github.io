<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title> | ballen博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ballen博客</h1><a id="logo" href="/.">ballen博客</a><p class="description">专注于智能运维&amp;大数据</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">May 15, 2018<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta name="generator" content="pandoc">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
  /*
      http://www.oschina.net/question/124879_76399
  */
  
  html { font-size: 100%; overflow-y: scroll; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }
   
  body{
      color:#444;
      font-family:Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
      font-size:13px;
      line-height:1.5em;
      padding:1em;
      margin:auto;
      max-width:42em;
      background:#fefefe;
  }
   
  h1, h2, h3, h4, h5, h6 {
      font-weight: bold;
  }
   
  h1 {
      color: #000000;
      font-size: 28px;
  }
   
  h2 {
      border-bottom: 2px solid #CCCCCC;
      color: #000000;
      font-size: 24px;
  }
   
  h3 {
      border-bottom: 2px solid #CCCCCC;
      font-size: 18px;
  }
   
  h4 {
      font-size: 16px;
  }
   
  h5 {
      font-size: 14px;
  }
   
  h6 {
      color: #777777;
      background-color: inherit;
      font-size: 14px;
  }
   
  hr {
      height: 0.2em;
      border: 0;
      color: #CCCCCC;
      background-color: #CCCCCC;
  }
   
  p, blockquote, ul, ol, dl, li, table, pre {
      margin: 15px 0;
  }
   
  p{
      margin:1em 0;
  }
   
  pre { 
      background-color: #F8F8F8;    
      border: 1px solid #CCCCCC;
      border-radius: 3px;
      overflow: auto;
      padding: 5px;
  }
   
  pre code {
      background-color: #F8F8F8;
      border: none;    
      padding: 0;
  }
   
  code {
      font-family: Consolas, Monaco, Andale Mono, monospace;
      background-color:#F8F8F8;
      border: 1px solid #CCCCCC;
      border-radius: 3px;
      padding: 0 0.2em;
      line-height: 1;
  }
   
  pre > code {
      border: 0;
      margin: 0;
      padding: 0;
  }
   
   
  a{ color: #0645ad; text-decoration:none;}
  a:visited{ color: #0b0080; }
  a:hover{ color: #06e; }
  a:active{ color:#faa700; }
  a:focus{ outline: thin dotted; }
  a:hover, a:active{ outline: 0; }
   
  ::-moz-selection{background:rgba(255,255,0,0.3);color:#000}
  ::selection{background:rgba(255,255,0,0.3);color:#000}
   
  a::-moz-selection{background:rgba(255,255,0,0.3);color:#0645ad}
  a::selection{background:rgba(255,255,0,0.3);color:#0645ad}
   
  blockquote{
      color:#666666;
      margin:0;
      padding-left: 3em;
      border-left: 0.5em #EEE solid;
  }
   
  ul, ol { margin: 1em 0; padding: 0 0 0 2em; }
  li p:last-child { margin:0 }
  dd { margin: 0 0 0 2em; }
   
  img { border: 0; -ms-interpolation-mode: bicubic; vertical-align: middle; max-width:100%;}
   
  table { border-collapse: collapse; border-spacing: 0; }
  td { vertical-align: top; }
   
  @media only screen and (min-width: 480px) {
      body{font-size:14px;}
  }
   
  @media only screen and (min-width: 768px) {
      body{font-size:16px;}
  }
  </style>
</head>
<body>
<h2 id="hadoop&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;">Hadoop&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;</h2>
<h1 id="&#21069;&#35328;">&#21069;&#35328;</h1>
<p>&#36817;&#26469;&#65292;&#19994;&#21153;&#37096;&#38376;&#22240;&#21382;&#21490;&#21407;&#22240;&#65292;&#24076;&#26395;&#23545;&#29616;&#23384;&#30340;&#22270;&#29255;&#12289;&#23545;&#36134;&#31561;&#21382;&#21490;&#25991;&#20214;&#36827;&#34892;&#25913;&#36896;&#65292;&#30001;&#21407;&#20808;&#30340;&#21333;&#26426;&#23384;&#20648;&#25913;&#25104;&#20998;&#24067;&#24335;&#23384;&#20648;&#20415;&#20110;&#31649;&#29702;&#21644;&#32500;&#25252;&#65292;&#30446;&#21069;&#32452;&#20869;&#20063;&#22312;&#22823;&#21147;&#25512;&#24191;HDFS&#22312;&#37096;&#38376;&#30340;&#24212;&#29992; &#65292;&#25152;&#20197;&#22312;&#27492;&#32972;&#26223;&#19979;&#65292;&#35843;&#30740;&#20102;&#30446;&#21069;&#20851;&#20110;HDFS&#30340;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;&#65292;&#26412;&#25991;&#20250;&#30528;&#37325;&#20174;&#23567;&#25991;&#20214;&#38656;&#27714;&#20837;&#25163;&#65292;&#20998;&#26512;&#30446;&#21069;&#21508;&#31181;&#29616;&#26377;&#23567;&#25991;&#20214;&#23384;&#20648;&#30340;&#29366;&#20917;&#21450;&#21508;&#33258;&#20351;&#29992;&#30340;&#22330;&#26223;&#12290;</p>
<h1 id="hdfs&#24635;&#20307;&#26550;&#26500;">HDFS&#24635;&#20307;&#26550;&#26500;</h1>
<p>&#22312;&#20171;&#32461;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;&#20043;&#21069;&#65292;&#25105;&#35273;&#24471;&#26377;&#24517;&#35201;&#20808;&#20171;&#32461;&#19979;&#20851;&#20110;HDFS&#23384;&#20648;&#26550;&#26500;&#26041;&#38754;&#30340;&#19968;&#20123;&#30693;&#35782;&#65292;&#22312;&#23545;&#26550;&#26500;&#26377;&#21021;&#27493;&#20102;&#35299;&#21518;&#65292;&#25165;&#20250;&#26126;&#30333;&#20026;&#20160;&#20040;&#35201;&#21333;&#29420;&#38024;&#23545;&#23567;&#25991;&#20214;&#23637;&#24320;&#20171;&#32461;&#65292;&#23567;&#25991;&#20214;&#23384;&#20648;&#21644;&#20854;&#23427;&#25991;&#20214;&#23384;&#20648;&#21306;&#21035;&#22312;&#20160;&#20040;&#22320;&#26041;&#12290;</p>
<p>&#36825;&#37324;&#25105;&#21482;&#26159;&#23601;Hadoop&#29983;&#24577;&#20013;&#30340;&#23384;&#20648;&#23618;&#23637;&#24320;&#20171;&#32461;&#65292;&#23545;&#20110;&#20854;&#23427;&#37096;&#20998;&#26412;&#25991;&#26242;&#26410;&#25551;&#36848;&#12290;&#20247;&#25152;&#21608;&#30693;&#65292;HDFS&#26159;&#30446;&#21069;&#38750;&#24120;&#27969;&#34892;&#30340;&#20998;&#24067;&#24335;&#25991;&#20214;&#23384;&#20648;&#31995;&#32479;&#65292;&#20854;&#36923;&#36753;&#26550;&#26500;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306; <img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hadoop_1x_structure.jpg" alt="HDFS&#26550;&#26500;"></p>
<p>HDFS&#20063;&#26159;&#20856;&#22411;&#30340;Master/Slave&#32467;&#26500;&#65292;&#20854;&#20013;&#65292;Master&#30456;&#24403;&#20110;Namenode&#65292;Slave&#30456;&#24403;&#20110;Datanode&#12290;</p>
<p>Namenode &#36127;&#36131;&#20803;&#25968;&#25454;&#31649;&#29702;&#65292;&#32500;&#25252;&#25991;&#20214;&#21644;&#30446;&#24405;&#26641;&#65292;&#21709;&#24212;Client&#35831;&#27714;&#65307;Datanode&#36127;&#36131;&#23454;&#38469;&#25968;&#25454;&#23384;&#20648;&#12290;&#33267;&#20110;&#20160;&#20040;&#26159;&#20803;&#25968;&#25454;&#65292;&#26159;&#24590;&#20040;&#31649;&#29702;&#30340;&#65292;&#21487;&#21442;&#32771;&#25105;&#30340;&#21478;&#19968;&#31687;&#25991;&#31456;<a href="http://km.oa.com/group/11819/articles/show/319776" target="_blank" rel="external">Hadoop&#30340;HA&#26426;&#21046;</a>&#12290;</p>
<p>Block&#26159;&#25991;&#20214;&#22359;&#65292;HDFS&#20013;&#26159;&#20197;Block&#20026;&#21333;&#20301;&#36827;&#34892;&#25991;&#20214;&#30340;&#31649;&#29702;&#30340;&#65292;&#19968;&#20010;&#25991;&#20214;&#21487;&#33021;&#26377;&#22810;&#20010;&#22359;&#65292;&#27599;&#20010;&#22359;&#40664;&#35748;&#26159;3&#20010;&#21103;&#26412;&#65292;&#36825;&#20123;&#22359;&#20998;&#21035;&#23384;&#20648;&#22312;&#19981;&#21516;&#26426;&#22120;&#19978;&#12290;&#22359;&#19982;&#25991;&#20214;&#20043;&#21069;&#30340;&#26144;&#23556;&#20851;&#31995;&#20250;&#23450;&#26102;&#19978;&#25253;Namenode&#12290;HDFS&#20013;&#19968;&#20010;&#22359;&#30340;&#40664;&#35748;&#22823;&#23567;&#26159;64M&#65292;&#20854;&#22823;&#23567;&#30001;&#21442;&#25968;<code>dfs.block.size</code>&#25511;&#21046;&#12290;&#36825;&#37324;&#38754;&#20808;&#24341;&#30003;&#20960;&#20010;&#38382;&#39064;&#20986;&#26469;&#65306;</p>
<blockquote>
<ul>
<li><strong>&#38382;&#39064;1&#65306;&#22359;&#22823;&#23567;&#35201;&#24590;&#20040;&#35774;&#32622;&#20026;&#19968;&#20010;&#21512;&#29702;&#20540;&#65292;&#36807;&#22823;&#35774;&#32622;&#21644;&#36807;&#23567;&#35774;&#32622;&#26377;&#20160;&#20040;&#24433;&#21709;&#65311;</strong></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><strong>&#38382;&#39064;2&#65306;&#22914;&#26524;&#19968;&#20010;&#25991;&#20214;&#23567;&#20110;&#25152;&#35774;&#32622;&#30340;&#22359;&#22823;&#23567;&#65292;&#23454;&#38469;&#21344;&#29992;&#31354;&#38388;&#20250;&#24590;&#26679;&#65311;</strong></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><strong>&#38382;&#39064;3&#65306;&#19968;&#20010;Namenode&#26368;&#22810;&#33021;&#31649;&#29702;&#22810;&#23569;&#20010;&#22359;&#65292;&#20160;&#20040;&#26102;&#20505;&#20250;&#36798;&#21040;&#29942;&#39048;&#65311;</strong></li>
</ul>
</blockquote>
<p>&#38024;&#23545;&#36825;&#20123;&#38382;&#39064;&#65292;&#21518;&#38754;&#20250;&#23637;&#24320;&#20171;&#32461;&#65292;&#36825;&#37324;&#36824;&#26159;&#20808;&#20851;&#27880;&#19979;&#26550;&#26500;&#26041;&#38754;&#12290;&#38024;&#23545;&#22359;&#26041;&#38754;&#65292;&#26377;&#20960;&#20010;&#21333;&#20301;&#27010;&#24565;&#38656;&#35201;&#24324;&#28165;&#26970;&#65306; <strong>Block&#12289;Packet&#21644;Chunk</strong>&#12290;Block&#19978;&#38754;&#26377;&#25551;&#36848;&#65292;Packet&#21644;Chunk&#22914;&#19979;&#65306;</p>
<blockquote>
<ul>
<li><ol style="list-style-type: decimal">
<li><strong>Packet</strong>: &#20854;&#27604;&#22359;&#35201;&#23567;&#24456;&#22810;&#65292;&#21487;&#20197;&#29702;&#35299;&#20026;Linux&#25805;&#20316;&#31995;&#32479;&#26368;&#23567;&#30424;&#22359;&#27010;&#24565;&#65292;&#19968;&#33324;&#20026;64KB&#65292;&#30001;&#21442;&#25968;<code>dfs.write.packet.size</code>&#25511;&#21046;&#65292;&#26159;client&#21521;Datanode&#20889;&#20837;&#25968;&#25454;&#30340;&#31890;&#24230;&#65292;&#21363;client&#21521;Datanode&#20889;&#25968;&#25454;&#26102;&#19981;&#26159;&#19968;&#27425;&#20197;Block&#20026;&#21333;&#20301;&#20889;&#30340;&#65292;&#32780;&#26159;&#34987;&#20998;&#25104;&#33509;&#24178;Packet&#65292;&#25918;&#20837;pipeline&#39034;&#24207;&#36861;&#21152;&#20889;&#20837;&#21040;Block&#20013;&#65292;&#31034;&#24847;&#22270;&#22914;&#19979;&#65306;</li>
</ol></li>
</ul>
</blockquote>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_packet.png" alt="packet">
<p class="caption">packet</p>
</div>
<blockquote>
<ul>
<li><ol start="2" style="list-style-type: decimal">
<li><strong>Chunk</strong>: &#27604;Packet&#26356;&#23567;&#65292;&#26159;&#38024;&#23545;Packet&#25968;&#25454;&#26657;&#39564;&#31890;&#24230;&#26469;&#35774;&#35745;&#30340;&#65292;&#19968;&#33324;&#26159;512B,&#30001;&#21442;&#25968;<code>io.bytes.per.checksum</code>&#25511;&#21046;&#65292;&#21516;&#26102;&#36824;&#24102;&#26377;&#19968;&#20010;4B&#30340;&#26657;&#39564;&#20540;&#65292;&#25152;&#20197;&#21487;&#20197;&#35748;&#20026;&#19968;&#20010;Chunk&#26159;516B</li>
</ol></li>
</ul>
</blockquote>
<p>&#19978;&#38754;&#35828;&#21040;Chunk&#26159;&#38024;&#23545;&#25968;&#25454;&#26657;&#39564;&#30340;&#65292;&#37027;&#19968;&#20010;Packet&#26377;&#22810;&#23569;&#20010;chunk&#26657;&#39564;&#21602;&#65292;&#22914;&#26524;Packet&#40664;&#35748;&#26159;64KB, &#37027;&#35745;&#31639;&#20844;&#24335;&#20026;&#65306;<code>chunk&#20010;&#25968;=64KB/516B=128</code>&#12290;&#20063;&#23601;&#26159;&#23545;&#20110;&#19968;&#20010;Packet&#26469;&#35828;&#65292;&#25968;&#25454;&#20540;&#19982;&#26657;&#39564;&#20540;&#27604;&#20363;&#22823;&#27010;&#20026;<strong>128:1</strong>, &#23545;&#20110;&#19968;&#20010;&#22359;&#26469;&#35828;&#65292;&#20551;&#35774;&#26159;64M&#65292;&#20250;&#23545;&#24212;512KB&#30340;&#26657;&#39564;&#25991;&#20214;&#12290;</p>
<p>Packet&#30340;&#31034;&#24847;&#22270;&#20013;&#36824;&#19968;&#20010;Header&#20449;&#24687;&#65292;&#23454;&#38469;&#23384;&#20648;&#30340;&#26159;Packet&#30340;&#20803;&#25968;&#25454;&#20449;&#24687;&#65292;&#21253;&#25324;Packet&#22312;block&#20013;&#30340;offset, &#25968;&#25454;&#38271;&#24230;&#65292;&#26657;&#39564;&#32534;&#30721;&#31561;&#12290;</p>
<h1 id="hdfs&#20889;&#27969;&#31243;">HDFS&#20889;&#27969;&#31243;</h1>
<p>&#20102;&#35299;&#22359;&#30456;&#20851;&#27010;&#24565;&#21518;&#65292;&#20877;&#20171;&#32461;&#19979;HDFS&#30340;&#20889;&#20837;&#27969;&#31243;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_write_process.png" alt="HDFS&#20889;&#27969;&#31243;">
<p class="caption">HDFS&#20889;&#27969;&#31243;</p>
</div>
<blockquote>
<ul>
<li><ol style="list-style-type: decimal">
<li>client&#21521;Namenode&#21457;&#36215;&#20889;&#25991;&#20214;RPC&#35831;&#27714;&#65307;</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Namenode&#26816;&#26597;&#35201;&#20889;&#30340;&#25991;&#20214;&#26159;&#21542;&#24050;&#23384;&#22312;&#20803;&#25968;&#25454;&#20013;&#65292;&#23384;&#22312;&#21017;&#25298;&#32477;&#20889;&#20837;&#65307;&#21516;&#26102;&#26816;&#26597;&#20889;&#20837;&#29992;&#25143;&#26435;&#38480;&#65292;&#22914;&#26080;&#26435;&#38480;&#20063;&#25298;&#32477;&#20889;&#20837;&#65307;&#33509;&#25991;&#20214;&#19981;&#23384;&#22312;&#19988;&#26377;&#26435;&#38480;&#20889;&#20837;&#65292;&#21017;Namenode&#20250;&#21019;&#24314;&#19968;&#26465;&#25991;&#20214;&#35760;&#24405;&#65292;&#21709;&#24212;client&#31471;&#20801;&#35768;&#20889;&#20837;&#25991;&#20214;&#65307;</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>client&#26681;&#25454;&#25991;&#20214;&#22823;&#23567;&#20998;&#25104;&#33509;&#24178;&#22359;&#65292;&#24182;&#22312;Namenode&#20013;&#30003;&#35831;&#22359;&#25152;&#23384;&#25918;&#30340;Datanode&#20301;&#32622;&#65292;&#22914;&#26524;&#26159;3&#21103;&#26412;&#23384;&#20648;&#65292;&#21017;Namenode&#20250;&#36873;&#25321;3&#21488;&#31526;&#21512;&#26465;&#20214;&#30340;&#32467;&#28857;&#25918;&#21040;&#32467;&#28857;&#38431;&#21015;&#20013;&#65307;client&#23454;&#38469;&#21521;Datanode&#20889;&#25968;&#25454;&#26102;&#26159;&#20197;Packet&#20026;&#21333;&#20301;&#26469;&#20889;&#21040;Block&#30340;&#65292;&#36825;&#37324;&#38754;&#20250;&#28041;&#21450;&#20004;&#20010;&#38431;&#21015;&#65292;&#20998;&#21035;&#20026;:<strong>data packet&#38431;&#21015;</strong>&#21644;<strong>ack packet&#38431;&#21015;</strong>&#65292;Packet&#20250;&#21516;&#26102;&#20837;&#25968;&#25454;&#38431;&#21015;&#21644;ack&#38431;&#21015;&#65307;</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>&#36890;&#36807;DataStreamer&#23545;&#35937;&#23558;&#25968;&#25454;&#20889;&#20837;pipeline&#20013;&#30340;&#31532;&#19968;&#20010;Datanode,&#24182;&#20381;&#27425;&#20889;&#20837;&#21040;&#20854;&#23427;&#20004;&#20010;&#32467;&#28857;&#65307;&#24403;&#19977;&#20010;&#32467;&#28857;packet&#37117;&#20889;&#25104;&#21151;&#21518;&#65292;&#20250;&#23558;packets &#20174;ack queue&#20013;&#21024;&#38500;&#65307;</li>
</ol></li>
<li><ol start="5" style="list-style-type: decimal">
<li>&#20889;&#25805;&#20316;&#23436;&#25104;&#21518;&#65292;client&#35843;&#29992;close()&#20851;&#38381;&#20889;&#25805;&#20316;&#65292;&#24182;&#36890;&#30693;Namenode&#20851;&#38381;&#20889;&#25805;&#20316;&#65292;&#33267;&#27492;&#65292;&#25972;&#20010;&#20889;&#25805;&#20316;&#23436;&#25104;&#12290;</li>
</ol></li>
</ul>
</blockquote>
<p>packet&#20889;&#20837;&#27969;&#31034;&#24847;&#22270;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_packet_flow.png" alt="packet&#27969;&#31243;&#22270;">
<p class="caption">packet&#27969;&#31243;&#22270;</p>
</div>
<h1 id="hdfs&#35835;&#27969;&#31243;">HDFS&#35835;&#27969;&#31243;</h1>
<p>HDFS&#30340;&#35835;&#27969;&#31243;&#27604;&#36739;&#31616;&#21333;&#65292;&#27969;&#31243;&#31243;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_read_process.png" alt="HDFS&#35835;&#27969;&#31243;">
<p class="caption">HDFS&#35835;&#27969;&#31243;</p>
</div>
<blockquote>
<ul>
<li><ol style="list-style-type: decimal">
<li>client &#21521;Namenode&#21457;&#36215;&#35835;&#25991;&#20214;RPC&#35831;&#27714;&#65307;</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Namenode&#36820;&#22238;&#30456;&#24212;block&#25152;&#22312;datanode&#30340;&#20301;&#32622;&#20449;&#24687;&#65307;</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>client&#36890;&#36807;&#20301;&#32622;&#20449;&#24687;&#35843;&#29992;FSDataInputStream API&#30340;Read&#26041;&#27861;&#20174;datanode&#20013;&#24182;&#34892;&#35835;&#21462;block&#20449;&#24687;&#65292;&#22914;&#22270;&#20013;4&#21644;5&#25152;&#31034;&#65292;&#36873;&#25321;block&#30340;&#20854;&#20013;&#19968;&#21103;&#26412;&#36820;&#22238;client&#12290;</li>
</ol></li>
</ul>
</blockquote>
<h1 id="hdfs&#22359;&#20449;&#24687;&#20171;&#32461;">HDFS&#22359;&#20449;&#24687;&#20171;&#32461;</h1>
<p>&#22312;&#23545;HDFS&#30340;&#35835;&#20889;&#27969;&#31243;&#26377;&#19968;&#20010;&#22522;&#30784;&#20102;&#35299;&#21518;&#65292;&#19979;&#38754;&#38024;&#23545;&#25991;&#20214;&#22359;&#23384;&#20648;&#30456;&#20851;&#20869;&#23481;&#23637;&#24320;&#20171;&#32461;&#12290;&#20102;&#35299;&#22359;&#30340;&#35774;&#35745;&#12289;&#23384;&#20648;&#21644;&#20803;&#25968;&#25454;&#30456;&#20851;&#30693;&#35782;&#23545;&#20110;&#35774;&#35745;&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;&#20063;&#33267;&#20851;&#37325;&#35201;&#12290;</p>
<h2 id="hdfs&#22359;&#35774;&#35745;&#21407;&#21017;">HDFS&#22359;&#35774;&#35745;&#21407;&#21017;</h2>
<p>&#26377;&#20154;&#21487;&#33021;&#20250;&#38382;&#65292;&#38598;&#32676;&#23384;&#20648;&#26377;&#22823;&#25991;&#20214;&#20063;&#26377;&#23567;&#25991;&#20214;&#65292;&#37027;&#22359;&#22823;&#23567;&#35813;&#22914;&#20309;&#35774;&#35745;&#21602;&#65292;&#36825;&#37324;&#24212;&#35813;&#35201;&#32771;&#34385;2&#20010;&#20934;&#21017;&#65306;</p>
<blockquote>
<ul>
<li>1.&#20943;&#23569;&#20869;&#23384;&#21344;&#29992;&#65306;&#23545;&#20110;Namenode&#26469;&#35828;&#65292;&#21333;&#26426;&#20869;&#23384;&#27605;&#31455;&#26377;&#38480;&#65292;&#25991;&#20214;&#22359;&#36234;&#22810;&#65292;&#20803;&#25968;&#25454;&#20449;&#24687;&#36234;&#22823;&#65292;&#21344;&#29992;&#20869;&#23384;&#36234;&#22810;&#65292;&#22914;&#26524;&#25991;&#20214;&#25968;&#37327;&#32423;&#24456;&#22823;&#30340;&#35805;&#65292;&#21333;&#26426;&#23558;&#26080;&#27861;&#31649;&#29702;&#65307;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>2.&#20943;&#23569;&#30828;&#30424;&#23547;&#36947;&#26102;&#38388;&#65306; &#25968;&#25454;&#22359;&#22312;&#30828;&#30424;&#20026;&#36830;&#32493;&#23384;&#20648;&#65292;&#23545;&#20110;&#26222;&#36890;SATA&#30424;&#65292;&#38543;&#26426;&#23547;&#22336;&#36739;&#24930;&#65292; &#22914;&#26524;&#22359;&#35774;&#32622;&#36807;&#23567;&#65292;&#19968;&#20010;&#25991;&#20214;&#30340;&#22359;&#24635;&#25968;&#20250;&#36234;&#22810;&#65292;&#24847;&#21619;&#30528;&#30828;&#30424;&#23547;&#22336;&#26102;&#38388;&#20250;&#21152;&#38271;&#65292;&#33258;&#28982;&#21534;&#21520;&#37327;&#26080;&#27861;&#28385;&#36275;&#35201;&#27714;&#65307;&#22914;&#26524;&#22359;&#35774;&#32622;&#36807;&#22823;&#65292;&#19968;&#26041;&#38754;&#23545;&#20110;&#26222;&#36890;&#30424;&#26469;&#35828;IO&#24615;&#33021;&#20063;&#27604;&#36739;&#24046;&#65292;&#21152;&#36733;&#26102;&#20250;&#24456;&#24930;&#65292;&#21478;&#19968;&#26041;&#38754;&#65292;&#22359;&#36807;&#22823;&#65292;&#23545;&#20110;&#22810;&#21103;&#26412;&#26469;&#35828;&#65292;&#22312;&#21103;&#26412;&#20986;&#38382;&#39064;&#26102;&#65292;&#31995;&#32479;&#24674;&#22797;&#26102;&#38388;&#36234;&#38271;&#12290;</li>
</ul>
</blockquote>
<p>&#25152;&#20197;&#35774;&#32622;&#21512;&#29702;&#30340;&#22359;&#22823;&#23567;&#20063;&#24456;&#37325;&#35201;&#65292;&#19968;&#33324;&#26469;&#35828;&#26681;&#25454;&#38598;&#32676;&#30340;&#38656;&#27714;&#26469;&#35774;&#23450;&#65292;&#27604;&#22914;&#23545;&#20110;&#20351;&#29992;&#21040;HBase&#30340;&#22330;&#26223;&#65292;&#19968;&#33324;&#25968;&#25454;&#37327;&#20250;&#27604;&#36739;&#22823;&#65292;&#22359;&#19981;&#23452;&#35774;&#32622;&#22826;&#23567;&#65292;&#21442;&#32771;&#20540;&#19968;&#33324;&#20026;128MB&#25110;256MB&#65292;&#36825;&#26679;&#33021;&#23613;&#37327;&#36991;&#20813;&#39057;&#32321;&#22359;&#21047;&#20889;&#21644;&#22359;&#20803;&#25968;&#25454;&#20449;&#24687;&#30340;&#33192;&#32960;&#65307;&#23545;&#20110;&#23384;&#20648;&#23567;&#25991;&#20214;&#30340;&#22330;&#26223;&#65292;&#22914;&#22270;&#29255;&#65292;&#22359;&#21487;&#35774;&#32622;&#25104;&#40664;&#35748;64MB&#22823;&#23567;&#65292;&#19968;&#20010;&#22359;&#20013;&#23384;&#20648;&#22810;&#20010;&#22270;&#29255;&#25991;&#20214;&#65292;&#21518;&#38754;&#20250;&#35814;&#32454;&#20171;&#32461;&#12290;</p>
<h2 id="hdfs&#22359;&#23384;&#20648;&#21407;&#21017;">HDFS&#22359;&#23384;&#20648;&#21407;&#21017;</h2>
<p>&#22359;&#22312;HDFS&#20013;&#26159;&#24590;&#20040;&#23384;&#20648;&#30340;&#21602;&#65292;&#19978;&#38754;&#26377;&#25552;&#21040;&#22810;&#21103;&#26412;&#26426;&#21046;&#65292;&#21363;&#19968;&#20010;&#22359;&#22312;HDFS&#20013;&#26159;&#26681;&#25454;<strong>dfs.replication</strong>&#21442;&#25968;&#25152;&#35774;&#32622;&#30340;&#20540;&#26469;&#30830;&#23450;&#21103;&#26412;&#25968;&#30340;&#65292;&#40664;&#35748;&#20026;3&#12290;&#19977;&#20010;&#21103;&#26412;&#26159;&#38543;&#26426;&#23384;&#20648;&#19977;&#21488;&#25968;&#25454;&#32467;&#28857;Datanode&#19978;&#65292;&#19977;&#20010;&#32467;&#28857;&#30340;&#36873;&#21462;&#36981;&#24490;&#26426;&#26550;&#24863;&#30693;&#31574;&#30053;&#65292;&#36890;&#36807;<strong>topology.script.file.name</strong>&#26469;&#35774;&#32622;&#65292; &#22914;&#26524;&#37197;&#32622;&#20013;&#26410;&#37197;&#32622;&#26426;&#26550;&#24863;&#30693;&#65292;Namenode&#26159;&#26080;&#27861;&#30693;&#36947;&#26426;&#25151;&#32593;&#32476;&#25299;&#25169;&#65292;&#25152;&#20197;&#20250;&#38543;&#26426;&#36873;&#21462;3&#21488;&#32467;&#28857;&#36827;&#34892;&#22359;&#23384;&#20648;&#65292;&#22914;&#26524;&#35774;&#32622;&#20102;&#26426;&#26550;&#24863;&#30693;&#65292;&#21017;&#22312;&#23384;&#20648;&#26102;&#20250;&#22312;&#21516;&#26426;&#26550;&#23384;&#20648;2&#21103;&#26412;&#65292;&#19981;&#21516;&#26426;&#26550;&#25918;&#31532;3&#20010;&#21103;&#26412;&#65292;&#36825;&#26679;&#19968;&#26086;&#19968;&#20010;&#26426;&#26550;&#20986;&#29616;&#38382;&#39064;&#65292;&#36824;&#33021;&#20445;&#35777;&#19968;&#20010;&#21103;&#26412;&#26159;&#21487;&#29992;&#30340;&#12290;</p>
<p>&#22914;&#26524;&#19968;&#20010;&#25991;&#20214;&#21482;&#26377;&#20960;K&#65292;&#19988;&#23567;&#20110;HDFS&#22359;&#22823;&#23567;&#65292;&#23454;&#38469;&#22312;HDFS&#21344;&#29992;&#30340;&#31354;&#38388;&#20250;&#26159;&#22810;&#23569;&#21602;&#65311;&#31572;&#26696;&#26159;&#25991;&#20214;&#22823;&#23567;&#21363;&#20026;&#23454;&#38469;&#21344;&#29992;&#31354;&#38388;&#65292;&#23545;&#20110;&#20960;K&#30340;&#25991;&#20214;&#23454;&#38469;&#21344;&#29992;&#30340;&#31354;&#38388;&#22823;&#23567;&#20063;&#20026;&#20960;K&#65292;&#19981;&#20250;&#21344;&#29992;&#19968;&#20010;&#22359;&#31354;&#38388;&#12290;</p>
<h2 id="hdfs&#22359;&#20803;&#25968;&#25454;&#20449;&#24687;">HDFS&#22359;&#20803;&#25968;&#25454;&#20449;&#24687;</h2>
<p>&#19978;&#38754;&#25552;&#21040;&#65292;&#22312;&#23384;&#20648;&#30340;&#25991;&#20214;&#25968;&#37327;&#32423;&#24456;&#22823;&#26102;&#65292;&#21333;&#26426;Namenode&#20869;&#23384;&#28040;&#32791;&#20250;&#24613;&#21095;&#22686;&#22823;&#65292;&#26131;&#35302;&#21457;&#21333;&#26426;&#29942;&#39048;&#65292;&#37027;&#20040;&#21040;&#24213;&#19968;&#20010;Namenode&#21487;&#20197;&#31649;&#29702;&#22810;&#23569;&#37327;&#32423;&#30340;&#20803;&#25968;&#25454;&#21602;&#65292;&#20854;&#23454;&#36825;&#20010;&#21487;&#20197;&#26377;&#19968;&#20010;&#20844;&#24335;&#26469;&#21021;&#30053;&#20272;&#31639;&#12290;&#36825;&#37324;&#39318;&#20808;&#35201;&#20102;&#35299;&#19968;&#20010;&#27010;&#24565;&#65292;&#20803;&#25968;&#25454;&#21253;&#25324;&#21738;&#20123;&#65292;&#27491;&#24120;&#20803;&#25968;&#25454;&#21253;&#25324;&#19977;&#20010;&#37096;&#20998;&#65306;<strong>&#25991;&#20214;&#12289;&#30446;&#24405;&#21644;&#22359;</strong>&#12290;&#36825;&#19977;&#37096;&#20998;&#22312;&#20803;&#25968;&#25454;&#20013;&#21508;&#21344;&#29992;&#22810;&#23569;&#31354;&#38388;&#21602;&#65292;&#19979;&#38754;&#26159;&#19968;&#20010;&#21021;&#30053;&#30340;&#35745;&#31639;&#65306;</p>
<blockquote>
<ul>
<li><ol style="list-style-type: decimal">
<li>&#21333;&#26465;&#20803;&#25968;&#25454;&#22823;&#23567;&#65306;&#25991;&#20214;&#32422;250B&#65292;&#30446;&#24405;&#32422;290B&#65292;&#22359;&#32422;368B(152B+72*&#21103;&#26412;&#25968;3)</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>&#38598;&#32676;&#20803;&#25968;&#25454;&#24635;&#26465;&#25968;&#65306;&#25991;&#20214;&#25968;&#32422;10000&#20010;&#65292;&#30446;&#24405;&#32422;5000&#20010;&#65292;&#22359;&#32422;20000&#20010;</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>&#24635;&#21344;&#29992;&#20869;&#23384;&#22823;&#23567;&#65306; 250B<em>10000+290B</em>5000+368B*20000=10.78M</li>
</ol></li>
</ul>
</blockquote>
<p>&#23454;&#38469;&#20869;&#23384;&#28040;&#32791;&#20250;&#27604;&#36825;&#22810;&#65292;&#22240;&#20026;&#36824;&#26377;&#20854;&#23427;&#19968;&#20123;&#20449;&#24687;&#38656;&#35201;&#23384;&#20648;&#65292;&#24635;&#20307;&#20869;&#23384;&#28040;&#32791;&#21487;&#26681;&#25454;&#19978;&#36848;&#20844;&#24335;&#26469;&#20272;&#31639;&#65292;&#36825;&#26679;&#20320;&#23601;&#30693;&#36947;&#20320;&#38598;&#32676;Namenode&#33021;&#25215;&#21463;&#22810;&#23569;&#25991;&#20214;&#65292;&#30446;&#24405;&#21644;&#22359;&#20803;&#25968;&#25454;&#20449;&#24687;&#30340;&#23384;&#20648;&#12290;&#20063;&#33021;&#21450;&#26102;&#21457;&#29616;&#20869;&#23384;&#29942;&#39048;&#65292;&#20570;&#21040;&#31934;&#32454;&#21270;&#30417;&#25511;&#36816;&#33829;&#31649;&#29702;&#12290;</p>
<p>&#19978;&#36848;&#20171;&#32461;&#30340;&#19977;&#20010;&#26041;&#38754;&#20063;&#20998;&#21035;&#35299;&#31572;&#20102;&#19978;&#38754;&#25552;&#21040;&#30340;&#19977;&#20010;&#38382;&#39064;&#65292;&#20855;&#20307;&#32454;&#33410;&#36825;&#37324;&#20063;&#19981;&#36807;&#22810;&#23637;&#24320;&#12290;&#19979;&#38754;&#27491;&#24335;&#23637;&#24320;&#23545;&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#38754;&#30340;&#20171;&#32461;</p>
<h1 id="hdfs&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;">HDFS&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;</h1>
<p>&#38024;&#23545;&#23567;&#25991;&#20214;&#38382;&#39064;&#65292;HDFS&#33258;&#36523;&#20063;&#26377;&#32771;&#34385;&#36825;&#31181;&#22330;&#26223;&#65292;&#30446;&#21069;&#24050;&#30693;&#30340;&#20027;&#35201;&#26377;&#19977;&#31181;&#26041;&#26696;&#26469;&#23454;&#29616;&#36825;&#31181;&#23384;&#20648;&#65292;&#20998;&#21035;&#22914;&#19979;&#65306;</p>
<blockquote>
<ul>
<li>HAR</li>
<li>SequenceFile</li>
<li>CombinedFile</li>
</ul>
</blockquote>
<h2 id="har&#23384;&#20648;&#26041;&#26696;">HAR&#23384;&#20648;&#26041;&#26696;</h2>
<p>HAR&#29087;&#31216;Hadoop&#24402;&#26723;&#25991;&#20214;&#65292;&#25991;&#20214;&#20197;*.har&#32467;&#23614;&#12290;&#24402;&#26723;&#30340;&#24847;&#24605;&#23601;&#26159;&#23558;&#22810;&#20010;&#23567;&#25991;&#20214;&#24402;&#26723;&#20026;&#19968;&#20010;&#25991;&#20214;&#65292;&#24402;&#26723;&#25991;&#20214;&#20013;&#21253;&#21547;&#20803;&#25968;&#25454;&#20449;&#24687;&#21644;&#23567;&#25991;&#20214;&#20869;&#23481;&#65292;&#21363;&#20174;&#19968;&#23450;&#31243;&#24230;&#19978;&#23558;Namenode&#31649;&#29702;&#30340;&#20803;&#25968;&#25454;&#20449;&#24687;&#19979;&#27785;&#21040;Datanode&#19978;&#30340;&#24402;&#26723;&#25991;&#20214;&#20013;&#65292;&#36991;&#20813;&#20803;&#25968;&#25454;&#30340;&#33192;&#32960;&#12290;</p>
<p>&#24402;&#26723;&#25991;&#20214;&#26159;&#24590;&#20040;&#29983;&#25104;&#30340;&#21602;&#65292;&#20027;&#35201;&#36824;&#26159;&#20381;&#36182;&#20110;MapReduce&#21407;&#29702;&#23558;&#23567;&#25991;&#20214;&#20869;&#23481;&#36827;&#34892;&#24402;&#24182;&#12290;&#24402;&#26723;&#25991;&#20214;&#30340;&#22823;&#27010;&#32452;&#25104;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_har.png" alt="HDFS HAR&#32452;&#25104;">
<p class="caption">HDFS HAR&#32452;&#25104;</p>
</div>
<p>&#22270;&#20013;&#65292;&#24038;&#36793;&#26159;&#21407;&#22987;&#23567;&#25991;&#20214;&#65292;&#21491;&#36793;&#26159;har&#32452;&#25104;&#12290;&#20027;&#35201;&#21253;&#25324;&#65306;<code>_masterindex</code>&#12289;<code>_index</code>&#12289;<code>part-0...part-n</code>&#12290;&#20854;&#20013;_masterindex&#21644;_index&#23601;&#26159;&#30456;&#24212;&#30340;&#20803;&#25968;&#25454;&#20449;&#24687;&#65292;part-0...part-n&#23601;&#26159;&#30456;&#24212;&#30340;&#23567;&#25991;&#20214;&#20869;&#23481;&#12290;&#23454;&#38469;&#22312;&#38598;&#32676;&#20013;&#30340;&#23384;&#20648;&#32467;&#26500;&#22914;&#19979;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_har_1.png" alt="HDFS HAR&#21407;&#25991;&#20214;">
<p class="caption">HDFS HAR&#21407;&#25991;&#20214;</p>
</div>
<p>&#36890;&#36807;<code>hadoop archive</code>&#21629;&#20196;&#21019;&#24314;&#24402;&#26723;&#25991;&#20214;&#65292;-archiveName&#25351;&#23450;&#25991;&#20214;&#21517;, -p&#25351;&#23450;&#21407;&#25991;&#20214;&#36335;&#24452;&#65292;-r&#25351;&#23450;&#35201;&#24402;&#26723;&#30340;&#23567;&#25991;&#20214;,&#26368;&#21518;&#25351;&#23450;hdfs&#20013;&#24402;&#26723;&#25991;&#20214;&#23384;&#25918;&#36335;&#24452;&#65292;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_har_2.png" alt="HAR&#21019;&#24314;">
<p class="caption">HAR&#21019;&#24314;</p>
</div>
<p>&#21019;&#24314;&#21518;&#65292;&#20250;&#22312;/usr/archive&#30446;&#24405;&#19979;&#29983;&#25104;test.har&#30446;&#24405;&#65292;&#36825;&#37324;&#22823;&#23478;&#21487;&#33021;&#20250;&#26377;&#30097;&#24785;&#65292;&#19978;&#38754;&#19981;&#26159;&#35828;Har&#26159;&#19968;&#20010;&#25991;&#20214;&#21527;&#65292;&#36825;&#37324;&#24590;&#20040;&#21448;&#26159;&#30446;&#24405;&#20102;&#21602;&#65292;&#20854;&#23454;&#25105;&#20204;&#25152;&#35828;&#30340;&#24402;&#26723;&#25991;&#20214;&#26159;&#36923;&#36753;&#19978;&#30340;&#27010;&#24565;&#65292;&#32780;&#23454;&#38469;&#30340;har&#26159;&#19968;&#20010;&#30446;&#24405;&#65292;&#26159;&#19968;&#20010;&#29289;&#29702;&#23384;&#20648;&#27010;&#24565;&#65292;&#25152;&#20197;&#22823;&#23478;&#21482;&#35201;&#35760;&#20303;&#22312;&#23454;&#38469;&#23384;&#20648;&#26102;&#29983;&#25104;&#30340;Har&#23454;&#38469;&#19978;&#26159;&#19968;&#20010;&#30446;&#24405;&#23601;&#34892;&#20102;&#12290;&#36825;&#20010;&#30446;&#24405;&#20013;&#20250;&#23384;&#25918;&#20803;&#25968;&#25454;&#65292;&#23454;&#38469;&#25991;&#20214;&#20869;&#23481;&#12290;&#22914;&#19979;&#22270;&#25152;&#31034;&#65292;_index&#25991;&#20214;&#30340;&#27599;&#19968;&#34892;&#34920;&#31034;&#30340;&#26159;&#23567;&#25991;&#20214;&#22312;part&#24320;&#22836;&#30340;&#26144;&#23556;&#20851;&#31995;&#65292;&#21253;&#25324;&#36215;&#22987;&#21644;&#32467;&#26463;&#20301;&#32622;&#65292;&#26159;&#22312;&#21738;&#20010;part&#25991;&#20214;&#31561;&#65292;&#36825;&#26679;&#22312;&#35835;&#21462;har&#20013;&#30340;&#23567;&#25991;&#20214;&#26102;&#65292;&#26681;&#25454;offset&#20301;&#32622;&#21487;&#30452;&#25509;&#24471;&#21040;&#23567;&#25991;&#20214;&#20869;&#23481;&#65292;&#22914;&#22270;part-0&#25991;&#20214;&#20869;&#23481;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_har_3.png" alt="HAR&#32467;&#26500;">
<p class="caption">HAR&#32467;&#26500;</p>
</div>
<p>&#35201;&#20174;HAR&#35835;&#21462;&#19968;&#20010;&#23567;&#25991;&#20214;&#30340;&#35805;&#65292;&#38656;&#35201;&#29992;distcp&#26041;&#24335;&#65292;&#21407;&#29702;&#20063;&#26159;mapreduce, &#25351;&#23450;har&#36335;&#24452;&#21644;&#36755;&#20986;&#36335;&#24452;&#65292;&#21629;&#20196;&#22914;&#19979;&#65306; <code>hadoop distcp har:///user/archive/test.har/file-1 /tmp/archive/output</code></p>
<p>HAR&#24635;&#20307;&#27604;&#36739;&#31616;&#21333;&#65292;&#23427;&#26377;&#20160;&#20040;&#32570;&#28857;&#21602;?</p>
<blockquote>
<ul>
<li>1.archive&#25991;&#20214;&#19968;&#26086;&#21019;&#24314;&#19981;&#21487;&#20462;&#25913;&#21363;&#19981;&#33021;append&#65292;&#22914;&#26524;&#20854;&#20013;&#26576;&#20010;&#23567;&#25991;&#20214;&#26377;&#38382;&#39064;&#65292;&#24471;&#35299;&#21387;&#22788;&#29702;&#23436;&#24322;&#24120;&#25991;&#20214;&#21518;&#37325;&#26032;&#29983;&#25104;&#26032;&#30340;archive&#25991;&#20214;;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>2.&#23545;&#23567;&#25991;&#20214;&#24402;&#26723;&#21518;&#65292;&#21407;&#25991;&#20214;&#24182;&#26410;&#21024;&#38500;&#65292;&#38656;&#35201;&#25163;&#24037;&#21024;&#38500;;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>3.&#21019;&#24314;HAR&#21644;&#35299;&#21387;HAR&#20381;&#36182;MapReduce&#65292;&#26597;&#35810;&#25991;&#20214;&#26102;&#32791;&#24456;&#39640;;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>4.&#24402;&#26723;&#25991;&#20214;&#19981;&#25903;&#25345;&#21387;&#32553;&#12290;</li>
</ul>
</blockquote>
<h2 id="sequencefile&#23384;&#20648;&#26041;&#26696;">SequenceFile&#23384;&#20648;&#26041;&#26696;</h2>
<p>SequenceFile&#26412;&#36136;&#19978;&#26159;&#19968;&#31181;&#20108;&#36827;&#21046;&#25991;&#20214;&#26684;&#24335;&#65292;&#31867;&#20284;key-value&#23384;&#20648;&#65292;&#36890;&#36807;map/reducer&#30340;input/output format&#26041;&#24335;&#29983;&#25104;&#12290;&#25991;&#20214;&#20869;&#23481;&#30001;Header&#12289;Record/Block&#12289;SYNC&#26631;&#35760;&#32452;&#25104;&#65292;&#26681;&#25454;&#21387;&#32553;&#30340;&#26041;&#24335;&#19981;&#21516;&#65292;&#32452;&#32455;&#32467;&#26500;&#20063;&#19981;&#21516;&#65292;&#20027;&#35201;&#20998;&#20026;Record&#32452;&#32455;&#27169;&#24335;&#21644;Block&#32452;&#32455;&#27169;&#24335;&#12290;</p>
<h3 id="record&#32452;&#32455;&#27169;&#24335;">Record&#32452;&#32455;&#27169;&#24335;</h3>
<p>Record&#32452;&#32455;&#27169;&#24335;&#21448;&#21253;&#21547;&#20004;&#31181;&#65306;&#26410;&#21387;&#32553;&#29366;&#24577;CompressionType.NONE, &#21644;&#21387;&#32553;&#29366;&#24577;CompressionType.RECORD&#65292;&#26410;&#21387;&#32553;&#26159;&#25351;&#19981;&#23545;&#25968;&#25454;&#35760;&#24405;&#36827;&#34892;&#21387;&#32553;&#65292;&#21387;&#32553;&#24577;&#26159;&#25351;&#23545;&#27599;&#26465;&#35760;&#24405;&#30340;value&#36827;&#34892;&#21387;&#32553;&#65292;&#20854;&#36923;&#36753;&#32467;&#26500;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_sf_record.png" alt="Record&#27169;&#24335;">
<p class="caption">Record&#27169;&#24335;</p>
</div>
<p>Record&#32467;&#26500;&#20013;&#21253;&#21547;Record&#38271;&#24230;&#12289;key&#38271;&#24230;&#12289;key&#20540;&#21644;value&#20540;&#12290;Sync&#20805;&#26021;&#22312;Record&#20043;&#38388;&#65292;&#20854;&#20316;&#29992;&#20027;&#35201;&#26159;&#29992;&#20110;&#25991;&#20214;&#20301;&#32622;&#23450;&#20301;&#65292;&#20855;&#20307;&#23450;&#20301;&#26041;&#24335;&#26159;&#65306;&#22914;&#26524;&#25552;&#20379;&#30340;&#25991;&#20214;&#35835;&#21462;&#20301;&#32622;&#19981;&#26159;&#35760;&#24405;&#30340;&#36793;&#30028;&#21487;&#33021;&#22312;&#19968;&#20010;Record&#20013;&#38388;&#65292;&#22312;&#23454;&#38469;&#23450;&#20301;&#26102;&#20250;&#23450;&#20301;&#21040;&#25152;&#25552;&#20379;&#20301;&#32622;&#22788;&#20043;&#21518;&#30340;&#31532;&#19968;&#20010;Sync&#36793;&#30028;&#20301;&#32622;&#65292;&#24182;&#20174;&#35813;Sync&#28857;&#24448;&#21518;&#35835;&#30456;&#24212;&#38271;&#24230;&#30340;&#25968;&#25454;&#65292;&#22914;&#26524;&#25552;&#20379;&#30340;&#35835;&#21462;&#20301;&#32622;&#24448;&#21518;&#27809;&#26377;Sync&#36793;&#30028;&#28857;&#65292;&#21017;&#30452;&#25509;&#36339;&#36716;&#25991;&#20214;&#26411;&#23614;&#65307;&#22914;&#26524;&#25552;&#20379;&#30340;&#25991;&#20214;&#35835;&#21462;&#20301;&#32622;&#26159;Record&#36793;&#30028;&#65292;&#21017;&#30452;&#25509;&#20174;&#35813;&#20301;&#32622;&#24320;&#22987;&#35835;&#21462;&#25351;&#23450;&#38271;&#24230;&#30340;&#25968;&#25454;&#12290;&#21478;&#19968;&#31181;&#25991;&#20214;&#23450;&#20301;&#26041;&#24335;&#26159;seek, &#36825;&#31181;&#26041;&#24335;&#21017;&#35201;&#27714;&#25152;&#25552;&#20379;&#30340;&#35835;&#21462;&#20301;&#32622;&#26159;record&#30340;&#36793;&#30028;&#20301;&#32622;&#65292;&#19981;&#28982;&#22312;&#35835;&#21462;&#36845;&#20195;&#35835;&#21462;&#19979;&#19968;&#20010;&#20301;&#32622;&#26102;&#20250;&#20986;&#38169;&#12290;</p>
<h3 id="block&#32452;&#32455;&#27169;&#24335;">Block&#32452;&#32455;&#27169;&#24335;</h3>
<p>Block&#32452;&#32455;&#27169;&#24335;&#65292;&#20854;&#21387;&#32553;&#24577;&#20026;CompressionType.BLOCK&#12290;&#19982;Record&#27169;&#24335;&#19981;&#21516;&#30340;&#26102;&#65292;Block&#26159;&#20197;&#22359;&#20026;&#21333;&#20301;&#36827;&#34892;&#21387;&#32553;&#65292;&#21363;&#23558;&#22810;&#26465;Record&#20889;&#21040;&#19968;&#20010;&#22359;&#20013;&#65292;&#24403;&#36798;&#21040;&#19968;&#23450;&#22823;&#23567;&#26102;&#65292;&#23545;&#35813;&#22359;&#36827;&#34892;&#21387;&#32553;&#65292;&#24456;&#26174;&#28982;&#65292;&#22359;&#30340;&#21387;&#32553;&#25928;&#29575;&#20250;&#27604;Record&#35201;&#39640;&#24456;&#22810;&#65292;&#36991;&#20813;&#22823;&#37327;&#28040;&#36153;IO&#21644;CPU&#31561;&#36164;&#28304;&#12290;&#20854;&#36923;&#36753;&#32467;&#26500;&#22914;&#19979;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_sf_block.png" alt="Block&#27169;&#24335;">
<p class="caption">Block&#27169;&#24335;</p>
</div>
<p>&#20174;&#19978;&#22270;&#20013;&#21487;&#30475;&#20986;&#65292;&#32452;&#32455;&#26041;&#24335;&#21464;&#25104;&#20102;&#22359;&#65292;&#19968;&#20010;&#22359;&#20013;&#21448;&#21253;&#21547;&#20102;&#22359;&#30340;&#35760;&#24405;&#25968;&#65292;key&#38271;&#24230;&#65292;key&#20540;&#65292;value&#38271;&#24230;&#65292;value&#20540;&#12290;&#27599;&#20010;&#22359;&#20043;&#38388;&#20063;&#26377;Sync&#26631;&#35760;&#65292;&#20316;&#29992;&#21516;Record&#26041;&#24335;&#12290;</p>
<p>&#20004;&#20013;&#27169;&#24335;&#20013;&#65292;&#37117;&#26377;header&#26631;&#35760;&#65292;&#21253;&#21547;&#20102;&#20123;&#22914;&#29256;&#26412;&#20449;&#24687;&#12289;KEY&#31867;&#21517;&#12289;VALUE&#31867;&#21517;&#12289;&#26159;&#21542;&#21387;&#32553;&#26631;&#35760;&#12289;&#26159;&#21542;&#22359;&#21387;&#32553;&#26631;&#35760;&#12289;&#32534;&#30721;&#31867;&#12289;&#20803;&#25968;&#25454;&#20449;&#24687;&#21644;Sync&#26631;&#35760;&#65292;&#20854;&#32467;&#26500;&#22914;&#19979;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_sf_header.png" alt="header&#32467;&#26500;">
<p class="caption">header&#32467;&#26500;</p>
</div>
<h3 id="sequencefile&#31034;&#20363;">SequenceFile&#31034;&#20363;</h3>
<p>&#36825;&#37324;&#20197;&#23384;&#20648;5&#20010;&#23567;&#30340;&#22270;&#29255;&#25991;&#20214;&#20026;&#20363;&#65292;&#28436;&#31034;&#19979;&#22914;&#20309;&#21019;&#24314;SequenceFile&#12290;&#39318;&#20808;&#23558;&#22270;&#29255;&#25991;&#20214;&#19978;&#20256;&#33267;hdfs&#30340;&#19968;&#20010;&#30446;&#24405;&#12290;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_sf_ex_1.png" alt="&#22270;&#29255;&#25991;&#20214;&#31034;&#20363;">
<p class="caption">&#22270;&#29255;&#25991;&#20214;&#31034;&#20363;</p>
</div>
<p>&#20854;&#27425;&#65292;&#32534;&#20889;&#19968;&#20010;MR&#31243;&#24207;&#26469;&#23545;&#19978;&#36848;&#22270;&#29255;&#36827;&#34892;&#36716;&#25442;&#65292;&#23558;&#29983;&#25104;&#30340;&#25991;&#20214;&#23384;&#25918;&#21040;/tmp/sequencefile/seq&#19979;&#65292;MR&#31243;&#24207;&#28304;&#30721;&#22312;&#38468;&#20214;SmallFiles.zip&#20013;&#65292;&#21487;&#33258;&#34892;&#26597;&#30475;&#65292;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_sf_ex_2.png" alt="MR&#31243;&#24207;&#36716;&#25442;">
<p class="caption">MR&#31243;&#24207;&#36716;&#25442;</p>
</div>
<p>&#36716;&#25442;&#21518;&#65292;&#20250;&#22312;/tmp/sequencefile/seq&#30446;&#24405;&#29983;&#25104;&#19968;&#20010;part-r-00000&#25991;&#20214;&#65292;&#36825;&#20010;&#25991;&#20214;&#37324;&#38754;&#23601;&#21253;&#21547;&#20102;&#19978;&#36848;5&#20010;&#22270;&#29255;&#25991;&#20214;&#30340;&#20869;&#23481;&#65292;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_sf_ex_3.png" alt="SequenceFile&#30446;&#24405;&#32467;&#26500;">
<p class="caption">SequenceFile&#30446;&#24405;&#32467;&#26500;</p>
</div>
<p>&#22914;&#26524;&#35201;&#20174;&#35813;SequenceFile&#20013;&#33719;&#21462;&#25152;&#26377;&#22270;&#29255;&#25991;&#20214;&#65292;&#20877;&#36890;&#36807;MR&#31243;&#24207;&#20174;&#25991;&#20214;&#20013;&#23558;&#22270;&#29255;&#25991;&#20214;&#21462;&#20986;&#65292;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hdfs_sf_ex_4.png" alt="SequenceFile&#21462;&#25991;&#20214;">
<p class="caption">SequenceFile&#21462;&#25991;&#20214;</p>
</div>
<h3 id="sequencefile&#20248;&#32570;&#28857;">SequenceFile&#20248;&#32570;&#28857;</h3>
<h4 id="&#20248;&#28857;">&#20248;&#28857;</h4>
<blockquote>
<ul>
<li>A.&#25903;&#25345;&#22522;&#20110;&#35760;&#24405;&#25110;&#22359;&#30340;&#25968;&#25454;&#21387;&#32553;;</li>
<li>B. &#25903;&#25345;splitable,&#33021;&#22815;&#20316;&#20026;mr &#30340;&#36755;&#20837;&#20998;&#29255;;</li>
<li>C. &#19981;&#29992;&#32771;&#34385;&#20855;&#20307;&#23384;&#20648;&#26684;&#24335;&#65292;&#20889;&#20837;&#35835;&#21462;&#36739;&#31616;&#21333;.</li>
</ul>
</blockquote>
<h4 id="&#32570;&#28857;">&#32570;&#28857;</h4>
<blockquote>
<ul>
<li>A. &#38656;&#35201;&#19968;&#20010;&#21512;&#24182;&#25991;&#20214;&#30340;&#36807;&#31243;</li>
<li>B. &#20381;&#36182;&#20110;MapReduce</li>
<li>C. &#20108;&#36827;&#21046;&#25991;&#20214;&#65292;&#21512;&#24182;&#21518;&#19981;&#26041;&#20415;&#26597;&#30475;</li>
</ul>
</blockquote>
<h2 id="combinedfile&#23384;&#20648;&#26041;&#26696;">CombinedFile&#23384;&#20648;&#26041;&#26696;</h2>
<p>&#20854;&#21407;&#29702;&#20063;&#26159;&#22522;&#20110;Map/Reduce&#23558;&#21407;&#25991;&#20214;&#36827;&#34892;&#36716;&#25442;&#65292;&#36890;&#36807;CombineFileInputFormat&#31867;&#23558;&#22810;&#20010;&#25991;&#20214;&#20998;&#21035;&#25171;&#21253;&#21040;&#19968;&#20010;split&#20013;&#65292;&#27599;&#20010;mapper&#22788;&#29702;&#19968;&#20010;split, &#25552;&#39640;&#24182;&#21457;&#22788;&#29702;&#25928;&#29575;&#65292;&#23545;&#20110;&#26377;&#22823;&#37327;&#23567;&#25991;&#20214;&#30340;&#22330;&#26223;&#65292;&#36890;&#36807;&#36825;&#31181;&#26041;&#24335;&#33021;&#24555;&#36895;&#23558;&#23567;&#25991;&#20214;&#36827;&#34892;&#25972;&#21512;&#12290;&#26368;&#32456;&#30340;&#21512;&#24182;&#25991;&#20214;&#26159;&#23558;&#22810;&#20010;&#23567;&#25991;&#20214;&#20869;&#23481;&#25972;&#21512;&#21040;&#19968;&#20010;&#25991;&#20214;&#20013;&#65292;&#27599;&#19968;&#34892;&#24320;&#22987;&#21253;&#21547;&#27599;&#20010;&#23567;&#25991;&#20214;&#30340;&#23436;&#25972;hdfs&#36335;&#24452;&#21517;&#65292;&#36825;&#23601;&#20250;&#20986;&#29616;&#19968;&#20010;&#38382;&#39064;&#65292;&#22914;&#26524;&#35201;&#21512;&#24182;&#30340;&#23567;&#25991;&#20214;&#24456;&#22810;&#65292;&#37027;&#20040;&#26368;&#32456;&#21512;&#24182;&#30340;&#25991;&#20214;&#20250;&#21253;&#21547;&#36807;&#22810;&#30340;&#39069;&#22806;&#20449;&#24687;&#65292;&#28010;&#36153;&#36807;&#22810;&#30340;&#31354;&#38388;&#65292;&#25152;&#20197;&#36825;&#31181;&#26041;&#26696;&#30446;&#21069;&#30456;&#23545;&#29992;&#24471;&#27604;&#36739;&#23569;&#65292;&#19979;&#38754;&#26159;&#20351;&#29992;CombineFile&#30340;&#31034;&#20363;&#65306;</p>
<p>```hbaseadmin@10-163-161-229:~/program/mr/input&gt; ls hbaseadmin@10-163-161-229:~/program/mr/input&gt; touch file-1 file-2 file-3 hbaseadmin@10-163-161-229:~/program/mr/input&gt; echo &quot;this is file-1&quot; &gt;file-1 hbaseadmin@10-163-161-229:~/program/mr/input&gt; echo &quot;this is file-2&quot; &gt;file-2 hbaseadmin@10-163-161-229:~/program/mr/input&gt; echo &quot;this is file-3&quot; &gt;file-3 hbaseadmin@10-163-161-229:~/program/mr&gt; hadoop fs -put input /tmp/combinefile/</p>
<p>hbaseadmin@10-163-161-229:~/program/mr&gt; hadoop jar SmallFiles.jar com.fit.dba.mr.util.CombineFileTest /tmp/combinefile/input/ /tmp/combinefile/output</p>
<p>hbaseadmin@10-163-161-229:~/program/mr&gt; hadoop fs -ls /tmp/combinefile/output Found 2 items -rw-r--r-- 1 hbaseadmin supergroup 0 2018-03-25 17:26 /tmp/combinefile/output/_SUCCESS -rw-r--r-- 1 hbaseadmin supergroup 213 2018-03-25 17:26 /tmp/combinefile/output/part-r-00000 hbaseadmin@10-163-161-229:~/program/mr&gt; hadoop fs -ls /tmp/combinefile/output/part-r-00000 Found 1 items -rw-r--r-- 1 hbaseadmin supergroup 213 2018-03-25 17:26 /tmp/combinefile/output/part-r-00000 hbaseadmin@10-163-161-229:~/program/mr&gt; hadoop fs -cat /tmp/combinefile/output/part-r-00000 hdfs://10-163-161-229:9000/tmp/combinefile/input/file-1 this is file-1 hdfs://10-163-161-229:9000/tmp/combinefile/input/file-2 this is file-2 hdfs://10-163-161-229:9000/tmp/combinefile/input/file-3 this is file-3 ```</p>
<p>&#19978;&#36848;&#29992;&#21040;&#30340;&#36716;&#25442;&#31243;&#24207;&#20063;&#22312;&#38468;&#20214;CombineFileTest.java&#20013;&#12290;&#20854;&#20248;&#28857;&#26159;&#36866;&#29992;&#20110;&#22788;&#29702;&#22823;&#37327;&#27604;block&#23567;&#30340;&#25991;&#20214;&#21644;&#20869;&#23481;&#27604;&#36739;&#23569;&#30340;&#25991;&#20214;&#21512;&#24182;&#65292;&#23588;&#20854;&#26159;&#25991;&#26412;&#31867;&#22411;/sequencefile&#31561;&#25991;&#20214;&#21512;&#24182;&#65292;&#20854;&#32570;&#28857;&#26159;&#65306;&#22914;&#26524;&#27809;&#26377;&#21512;&#29702;&#30340;&#35774;&#32622;maxSplitSize&#65292;minSizeNode&#65292;minSizeRack&#65292;&#21017;&#21487;&#33021;&#20250;&#23548;&#33268;&#19968;&#20010;map&#20219;&#21153;&#38656;&#35201;&#22823;&#37327;&#35775;&#38382;&#38750;&#26412;&#22320;&#30340;Block&#36896;&#25104;&#32593;&#32476;&#24320;&#38144;&#65292;&#21453;&#32780;&#27604;&#27491;&#24120;&#30340;&#38750;&#21512;&#24182;&#26041;&#24335;&#26356;&#24930;&#12290;</p>
<h2 id="&#24635;&#32467;">&#24635;&#32467;</h2>
<p>&#19978;&#38754;&#20171;&#32461;&#20102;&#19977;&#31181;&#22522;&#20110;HDFS&#33258;&#36523;&#30340;&#19968;&#20123;&#26041;&#26696;&#65292;&#27599;&#31181;&#26041;&#26696;&#21508;&#26377;&#20248;&#32570;&#28857;&#65292;&#20854;&#26680;&#24515;&#24605;&#24819;&#37117;&#26159;&#22522;&#20110;map/reduce&#30340;&#26041;&#24335;&#23558;&#22810;&#20010;&#25991;&#20214;&#21512;&#24182;&#25104;&#19968;&#20010;&#25991;&#20214;&#12290;&#22312;&#23454;&#38469;&#20351;&#29992;&#20013;&#65292;&#21333;&#32431;&#29992;&#19978;&#36848;&#26041;&#26696;&#36824;&#26159;&#19981;&#22826;&#26041;&#20415;&#65292;&#19979;&#38754;&#31616;&#35201;&#20171;&#32461;&#19979;&#30446;&#21069;&#20854;&#23427;&#30340;&#19968;&#20123;&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;&#12290;</p>
<h1 id="&#20854;&#23427;&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;">&#20854;&#23427;&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;</h1>
<h2 id="&#22522;&#20110;hbase&#30340;&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;">&#22522;&#20110;HBase&#30340;&#23567;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;</h2>
<p>HBase&#25105;&#20204;&#30693;&#36947;&#20027;&#35201;&#26159;key/value&#23384;&#20648;&#32467;&#26500;&#65292;&#19968;&#20010;key&#23545;&#24212;&#22810;&#20010;&#21015;&#26063;&#30340;&#22810;&#20010;&#21015;&#20540;&#12290;&#20174;2.0&#29256;&#26412;&#24320;&#22987;&#65292;HBase&#22810;&#20102;&#19968;&#20010;MOB&#30340;&#32467;&#26500;&#65292;&#20855;&#20307;&#21442;&#32771;HBase-11339&#12290;&#20855;&#20307;&#26159;&#20160;&#20040;&#27010;&#24565;&#21602;&#65292;&#20808;&#26469;&#30475;&#19979;&#31034;&#24847;&#22270;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hbase_sf_mob.png" alt="hbase&#26550;&#26500;">
<p class="caption">hbase&#26550;&#26500;</p>
</div>
<p>&#19978;&#22270;&#26159;&#19968;&#20010;&#20851;&#20110;HBase&#30340;&#26550;&#26500;&#22270;&#65292;&#21253;&#21547;HBase&#30340;&#20960;&#20010;&#32452;&#20214;master&#12289;regionserver&#12289;hdfs&#12289;hfile&#31561;&#12290;MOB FILE&#31867;&#20284;StoreFile, &#23427;&#20316;&#20026;&#19968;&#20010;&#21333;&#29420;&#30340;&#23545;&#35937;&#23384;&#20648;&#23567;&#25991;&#20214;&#12290;MOB&#20855;&#20307;&#32467;&#26500;&#22914;&#19979;&#25152;&#31034;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hbase_sf_mob_structure.png" alt="mob&#32467;&#26500;">
<p class="caption">mob&#32467;&#26500;</p>
</div>
<p>MOB&#26159;&#30001;StoreFile&#21644;MOB File&#20849;&#21516;&#32452;&#25104;&#12290;&#20854;&#20013;&#65292;StoreFile&#23384;&#25918;&#30340;&#25968;&#25454;&#21644;HBase&#27491;&#24120;&#23384;&#20648;&#30340;&#25968;&#25454;&#19968;&#26679;&#65292;key/value&#32467;&#26500;&#65292;&#19981;&#36807;value&#20013;&#23384;&#20648;&#30340;&#26159;&#20851;&#20110;MOB&#25991;&#20214;&#30340;&#38271;&#24230;&#65292;&#23384;&#25918;&#36335;&#24452;&#31561;&#20803;&#25968;&#25454;&#20449;&#24687;&#65292;&#22312;MOB File&#20013;&#23384;&#20648;&#30340;&#26159;&#20855;&#20307;&#30340;MOB&#25991;&#20214;&#20869;&#23481;&#65292;&#36825;&#26679;&#36890;&#36807;StoreFile&#20013;&#30340;key/value&#21487;&#20197;&#25214;&#21040;MOB&#25152;&#23384;&#25918;&#30340;&#25991;&#20214;&#20855;&#20307;&#20301;&#32622;&#21644;&#22823;&#23567;&#65292;&#26368;&#32456;&#24471;&#21040;&#25991;&#20214;&#20869;&#23481;&#12290;</p>
<p>MOB&#26159;&#24590;&#20040;&#35774;&#32622;&#21602;&#65292;&#22312;&#21019;&#24314;&#34920;&#26102;&#25105;&#20204;&#25351;&#23450;&#34920;&#30340;MOB&#23646;&#24615;&#65292;&#22914;&#19979;&#25152;&#31034;&#65306; <code>create 't1', {NAME =&gt; 'f1', IS_MOB =&gt; true, MOB_THRESHOLD =&gt; 102400}</code></p>
<p>&#20854;&#20013;&#65292;MOB_THRESHOLD&#34920;&#31034;MOB&#23545;&#35937;&#25152;&#33021;&#23384;&#20648;&#30340;&#25991;&#20214;&#23545;&#35937;&#19978;&#38480;&#38408;&#20540;&#65292;&#25512;&#33616;&#26159;&#23384;&#20648;&#23567;&#20110;10M&#30340;&#25991;&#20214;&#12290;&#23545;&#20110;MOB&#30340;&#34920;&#65292;&#25105;&#20204;&#21487;&#20197;&#25163;&#21160;&#35302;&#21457;&#21387;&#32553;&#65292;&#26377;<strong>compact_mob</strong>&#21644;<strong>major_compact_mob</strong>&#20004;&#31181;&#26041;&#24335;&#12290;&#22914;&#19979;&#25152;&#31034;&#65306; <code>compact_mob 't1' compact_mob 't1','cf1' major_compact_mob 't1' major_compact_mob 't1','cf1'</code></p>
<p>MOB&#30340;&#20986;&#29616;&#22823;&#22823;&#25552;&#39640;&#20102;&#25105;&#20204;&#20351;&#29992;HBase&#23384;&#20648;&#23567;&#25991;&#20214;&#30340;&#25928;&#29575;&#65292;&#36825;&#26679;&#26080;&#39035;&#20851;&#27880;&#24213;&#23618;HDFS&#26159;&#24590;&#20040;&#23384;&#20648;&#30340;&#65292;&#21482;&#35201;&#20851;&#27880;&#19978;&#23618;&#36923;&#36753;&#21363;&#21487;&#65292;HBase&#30340;&#24378;&#22823;&#20248;&#21183;&#20063;&#33021;&#20445;&#35777;&#23384;&#20648;&#30340;&#39640;&#21487;&#38752;&#21644;&#31283;&#23450;&#24615;&#65292;&#31649;&#29702;&#20063;&#26041;&#20415;&#12290;</p>
<h2 id="&#22522;&#20110;&#25171;&#21253;&#26500;&#24314;&#32034;&#24341;&#26041;&#26696;">&#22522;&#20110;&#25171;&#21253;&#26500;&#24314;&#32034;&#24341;&#26041;&#26696;</h2>
<p>&#36825;&#31181;&#26041;&#26696;&#26159;&#30446;&#21069;&#20804;&#24351;&#37096;&#38376;&#27491;&#22312;&#20351;&#29992;&#30340;&#19968;&#20010;&#23567;&#22270;&#29255;&#23384;&#20648;&#26041;&#26696;&#65292;&#20063;&#26159;&#22522;&#20110;HDFS&#23384;&#20648;&#23454;&#38469;&#22270;&#29255;&#65292;&#22522;&#20110;HBase&#23384;&#20648;&#20803;&#25968;&#25454;&#20449;&#24687;&#12290;&#36825;&#20010;&#26041;&#26696;&#20013;&#65292;&#20027;&#35201;&#20063;&#26159;&#22522;&#20110;&#21387;&#32553;&#30340;&#24605;&#36335;&#65292;&#23558;&#22810;&#20010;&#23567;&#22270;&#19978;&#29255;&#21387;&#32553;&#25104;&#19968;&#20010;tar&#25991;&#20214;&#23384;&#25918;&#33267;HDFS&#19978;&#65292;&#36890;&#36807;HBASE&#35760;&#24405;&#25991;&#20214;&#21517;&#21644;HDFS&#25991;&#20214;&#30340;&#20301;&#32622;&#26144;&#23556;&#20851;&#31995;&#65292;&#26550;&#26500;&#31034;&#24847;&#22270;&#22914;&#19979;&#65306;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/hbase_sf_tar.png" alt="&#26550;&#26500;&#31034;&#24847;&#22270;">
<p class="caption">&#26550;&#26500;&#31034;&#24847;&#22270;</p>
</div>
<p>&#20854;&#20855;&#20307;&#24605;&#36335;&#26159;&#65306;</p>
<blockquote>
<ul>
<li>1.&#19994;&#21153;&#37096;&#38376;&#23558;&#22270;&#29255;&#19978;&#20256;&#33267;&#19968;&#20010;&#20013;&#36716;&#26426;&#65292;&#22270;&#29255;&#25353;&#26085;&#26399;&#30446;&#24405;&#23384;&#20648;&#65292;&#19981;&#21516;&#26085;&#26399;&#19978;&#20256;&#30340;&#22270;&#29255;&#25918;&#21040;&#30456;&#24212;&#26085;&#26399;&#30446;&#24405;&#65307;</li>
<li>2.&#23450;&#26399;&#29992;&#33050;&#26412;&#21435;&#23558;&#26085;&#26399;&#30446;&#24405;&#25171;&#21253;&#25104;tar&#65292;&#19968;&#22825;&#30340;&#22270;&#29255;&#25171;&#21253;&#25104;&#19968;&#20010;&#20197;&#26085;&#26399;&#21629;&#21517;&#30340;tar, tar&#25991;&#20214;&#35299;&#21387;&#21518;&#26159;&#30452;&#25509;&#22270;&#29255;&#25991;&#20214;&#65292;&#21363;&#19981;&#24102;&#26085;&#26399;&#37027;&#23618;&#30446;&#24405;&#65292;&#19978;&#20256;&#33267;HDFS&#25351;&#23450;&#30446;&#24405;&#65307;</li>
<li>3.&#36890;&#36807;tar&#25991;&#20214;&#35299;&#26512;&#31243;&#24207;&#33719;&#21462;tar&#25991;&#20214;&#20013;&#21508;&#22270;&#29255;&#25991;&#20214;&#22312;tar&#20013;&#30340;&#20559;&#31227;&#37327;&#21644;&#38271;&#24230;&#65292;&#36825;&#20010;&#35299;&#26512;&#31243;&#24207;&#26368;&#24320;&#22987;&#26159;&#30001;&#22269;&#22806;&#19968;&#20010;&#31243;&#24207;&#21592;Tom Wallroth&#20889;&#30340;&#24037;&#20855;,&#20855;&#20307;&#22320;&#22336;&#21487;&#20197;&#35775;&#38382;:http://github.com/devsnd/tarindexer&#12290; &#36825;&#20010;&#24037;&#20855;&#21487;&#20197;&#30452;&#25509;&#22312;tar&#25991;&#20214;&#19978;&#35299;&#26512;tar&#20013;&#21508;&#25991;&#20214;&#30340;&#20559;&#31227;&#37327;&#21644;&#38271;&#24230;&#65292;&#24456;&#26041;&#20415;&#12290;</li>
<li>4.&#24471;&#21040;&#22270;&#29255;&#25991;&#20214;&#22312;tar&#30340;&#20559;&#31227;&#37327;&#21644;&#38271;&#24230;&#21518;&#65292;&#35774;&#35745;HBase rowkey, &#23558;&#22270;&#29255;&#21517;&#21644;tar&#36335;&#24452;&#35774;&#35745;&#21040;rowkey&#20013;&#65292;&#24182;&#36890;&#36807;&#22312;rowkey&#21069;&#32512;&#21152;&#30416;&#26041;&#24335;&#20351;rowkey&#38543;&#26426;&#25955;&#21015;&#20998;&#24067;&#22312;HBase&#20013;&#65292;&#36991;&#20813;&#28909;&#28857;&#29616;&#35937;&#65307;HBase&#30340;value&#23384;&#20648;&#30340;&#26159;&#25991;&#20214;&#30340;&#20559;&#31227;&#37327;&#21644;&#38271;&#24230;&#12290;&#36825;&#26679;HBase&#20013;&#23601;&#20445;&#23384;&#20102;&#25991;&#20214;&#30340;&#20803;&#25968;&#25454;&#20449;&#24687;&#65307;</li>
<li><ol start="5" style="list-style-type: decimal">
<li>&#19994;&#21153;&#26041;&#26597;&#35810;&#20855;&#20307;&#26576;&#20010;&#22270;&#29255;&#26102;&#65292;&#26681;&#25454;&#22270;&#29255;&#30340;&#26085;&#26399;&#21644;&#22270;&#29255;&#21517;&#65292;&#20808;&#35745;&#31639;&#20986;HBase rowkey,&#20877;&#21435;HBase&#33719;&#21462;&#35813;&#22270;&#29255;&#30340;&#20559;&#31227;&#37327;&#21644;&#38271;&#24230;&#65307;&#36890;&#36807;&#20559;&#31227;&#37327;&#21644;&#38271;&#24230;&#36890;&#36807;HDFS&#30340;API&#21435;&#35835;&#21462;HDFS&#30340;&#25991;&#20214;&#12290;</li>
</ol></li>
</ul>
</blockquote>
<h2 id="&#20854;&#23427;&#26041;&#26696;&#23545;&#27604;">&#20854;&#23427;&#26041;&#26696;&#23545;&#27604;</h2>
<p>&#19979;&#38754;&#38024;&#23545;&#30446;&#21069;&#34892;&#19994;&#20869;&#29992;&#21040;&#30340;&#20854;&#23427;&#19968;&#20123;&#26041;&#26696;&#20316;&#19979;&#23545;&#27604;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#12290;</p>
<div class="figure">
<img src="/2018/05/15/~xsvorzjw.xhr/hadoop-small-file-storage/sf_compare.png" alt="&#26041;&#26696;&#23545;&#27604;">
<p class="caption">&#26041;&#26696;&#23545;&#27604;</p>
</div>
<p>&#24635;&#20307;&#26469;&#35828;&#65292;&#28120;&#23453;&#30340;TFS&#26159;&#21151;&#33021;&#26368;&#20840;&#30340;&#65292;&#21516;&#26102;&#25903;&#25345;&#22823;&#23567;&#25991;&#20214;&#30340;&#23384;&#20648;&#65307;Ceph&#20063;&#26159;&#19968;&#31181;&#27969;&#34892;&#30340;&#20998;&#24067;&#24335;&#25991;&#20214;&#23384;&#20648;&#26041;&#26696;&#65292;&#32452;&#20869;&#23545;&#20854;&#35843;&#30740;&#21518;&#24863;&#35273;&#27604;&#36739;&#22797;&#26434;&#65292;&#19981;&#22826;&#22909;&#31649;&#29702;&#65292;&#19981;&#22826;&#31283;&#23450;&#65307;FastDFS&#27604;&#36739;&#31616;&#21333;&#65292;&#36866;&#21512;&#23384;&#20648;&#19968;&#20123;&#20351;&#29992;&#22330;&#26223;&#31616;&#21333;&#30340;&#25991;&#20214;&#65292;&#19981;&#22826;&#28789;&#27963;&#65307;&#20854;&#23427;&#20960;&#31181;&#27809;&#29992;&#36807;&#65292;&#22823;&#23478;&#21487;&#33258;&#34892;&#19978;&#32593;&#21442;&#38405;&#30456;&#20851;&#36164;&#26009;&#12290;</p>
<h1 id="&#24635;&#32467;-1">&#24635;&#32467;</h1>
<p>&#26412;&#25991;&#20171;&#32461;&#20102;&#20851;&#20110;HDFS&#23567;&#25991;&#20214;&#23384;&#20648;&#30340;&#26041;&#26696;&#65292;&#19981;&#21516;&#26041;&#26696;&#21508;&#20855;&#29305;&#28857;&#65292;&#22312;&#20351;&#29992;&#26102;&#35201;&#26681;&#25454;&#23454;&#38469;&#19994;&#21153;&#22330;&#26223;&#36827;&#34892;&#35774;&#35745;&#65292;&#23545;&#20110;&#26082;&#35201;&#23384;&#20648;&#22823;&#25991;&#20214;&#21448;&#35201;&#23384;&#20648;&#23567;&#25991;&#20214;&#30340;&#22330;&#26223;&#65292;&#25105;&#24314;&#35758;&#22312;&#19978;&#23618;&#20316;&#19968;&#20010;&#36923;&#36753;&#22788;&#29702;&#23618;&#65292;&#22312;&#23384;&#20648;&#26102;&#20808;&#21028;&#26029;&#26159;&#22823;&#25991;&#20214;&#36824;&#26159;&#23567;&#25991;&#20214;&#65292;&#20877;&#20915;&#23450;&#26159;&#21542;&#29992;&#25171;&#21253;&#21387;&#32553;&#36824;&#26159;&#30452;&#25509;&#19978;&#20256;&#33267;HDFS&#65292;&#21487;&#20511;&#37492;TFS&#26041;&#26696;&#12290;</p>
<h1 id="&#21442;&#32771;">&#21442;&#32771;</h1>
<p><a href="hadoop-small-file-storage/hadoop_1x_structure.jpg">1</a> http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html</p>
<h1 id="&#38468;&#20214;">&#38468;&#20214;</h1>
<p>&#20851;&#20110;&#25991;&#31456;&#20013;&#29992;&#30340;MR&#36716;&#25442;&#31243;&#24207;&#22914;&#19979;&#25152;&#31034;&#65306; https://github.com/ballwql/common-tool/tree/master/java</p>
<p><strong>&#29256;&#26435;&#22768;&#26126;&#65306;&#26412;&#25991;&#20026;&#21338;&#20027;&#21407;&#21019;&#25991;&#31456;&#65292;&#26410;&#32463;&#21338;&#20027;&#20801;&#35768;&#19981;&#24471;&#36716;&#36733;&#12290;</strong></p>
</body>
</html>
</div><div class="tags"></div><div class="post-nav"><a href="/2018/05/15/~2qg1e2al.fnt/" class="next"></a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'ballwql## Your GitHub ID, e.g. username',
  repo: 'ballwql.github.io## The repository to store your comments, make sure you're the repo's owner, e.g. imsun.github.io',
  oauth: {
    client_id: 'e1067ce8b7aaa1a88a45## GitHub client ID, e.g. 75752dafe7907a897619',
    client_secret: '5f4e1d8d82c95a8610d5d19d51e97b7926fd5e71## GitHub client secret, e.g. ec2fb9054972c891289640354993b662f4cccc50',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://zendwind.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HBase/">HBase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/HBase/" style="font-size: 15px;">HBase</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/python/" style="font-size: 15px;">python</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/05/15/~xsvorzjw.xhr/">~xsvorzjw.xhr</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/15/~2qg1e2al.fnt/">~2qg1e2al.fnt</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/15/hdfs-multi-replicas-analysis/">hdfs-multi-replicas-analysis</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/25/hadoop-small-file-storage/">hadoop-small-file-storage</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/11/phoenix-introduction/">浅谈Phoenix在HBase中的应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/15/python-read-dump/">Python解析mysqldump文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/11/hbase-read-write-exception-summary/">HBase读写异常问题总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/08/hadoop-ha-qjm/">Hadoop HA机制学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/27/first-blog/">开篇导言</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.cnblogs.com/ballwql" title="Cnblogs" target="_blank">Cnblogs</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">ballen博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>